(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{1121:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,8346,23)),Promise.resolve().then(a.t.bind(a,347,23)),Promise.resolve().then(a.bind(a,7146)),Promise.resolve().then(a.bind(a,8651))},8651:(e,t,a)=>{"use strict";a.d(t,{StorageProvider:()=>c,r:()=>s});var r=a(5155),i=a(2115),l=a(7146),o=a(6960);let n=(0,i.createContext)(null),s=()=>{let e=(0,i.useContext)(n);if(!e)throw Error("useStorage must be used within a StorageProvider");return e},c=e=>{let{children:t}=e,{user:a}=(0,l.A)(),[s,c]=(0,i.useState)([]),[u,d]=(0,i.useState)({used:0,limit:0x140000000,percentage:0}),[h,y]=(0,i.useState)(!1),[w,f]=(0,i.useState)(null),m=(0,i.useCallback)(async()=>{if(!a){c([]);return}try{f(null);let e=await o.b.listUserFiles(a.uid);c(e)}catch(e){console.error("Error loading files:",e),f("Dosyalar y\xfcklenirken hata oluştu"),c([])}},[a]),p=(0,i.useCallback)(async()=>{if(!a){d({used:0,limit:0x140000000,percentage:0});return}try{let e=await o.b.calculateUserQuota(a.uid);d(e)}catch(e){console.error("Error loading quota:",e)}},[a]);(0,i.useEffect)(()=>{a?(m(),p()):(c([]),d({used:0,limit:0x140000000,percentage:0}))},[a,m,p]);let g=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pdf",r=arguments.length>2?arguments[2]:void 0;if(!a)throw Error("Kullanıcı giriş yapmamış");try{f(null),y(!0);let i=await o.b.uploadFile(a.uid,e,t,r);return await m(),await p(),i}catch(e){throw console.error("Error uploading file:",e),f("Dosya y\xfckleme başarısız"),e}finally{y(!1)}},b=async e=>{if(!a)throw Error("Kullanıcı giriş yapmamış");try{f(null),y(!0),await o.b.deleteFile(a.uid,e),await m(),await p()}catch(e){throw console.error("Error deleting file:",e),f("Dosya silinirken hata oluştu"),e}finally{y(!1)}},E=async()=>{await m()},F=async()=>{await p()},x=async()=>{if(!a)throw Error("Kullanıcı giriş yapmamış");try{f(null),y(!0);let e=await o.b.cleanupExpiredFiles(a.uid);return await m(),await p(),e}catch(e){throw console.error("Error cleaning up files:",e),f("Dosya temizleme başarısız"),e}finally{y(!1)}};return(0,r.jsx)(n.Provider,{value:{files:s,quota:u,loading:h,error:w,uploadFile:g,deleteFile:b,refreshFiles:E,refreshQuota:F,cleanupExpiredFiles:x},children:t})}},6960:(e,t,a)=>{"use strict";a.d(t,{b:()=>l});var r=a(333),i=a(4595);class l{static async uploadFile(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"pdf",l=arguments.length>3?arguments[3]:void 0;try{let o=Date.now(),n=l||"".concat(a,"_").concat(o,"_").concat(t.name),s="users/".concat(e,"/").concat(a,"/").concat(n),c=(0,r.KR)(i.IG,s),u={contentType:t.type,customMetadata:{userId:e,originalName:t.name,uploadedAt:new Date().toISOString(),expiresAt:new Date(Date.now()+2592e6).toISOString(),category:a}},d=await (0,r.D)(c,t,u),h=await (0,r.qk)(d.ref),y=await (0,r.yb)(d.ref),w={id:d.ref.name,name:n,fullPath:d.ref.fullPath,size:y.size,contentType:y.contentType||t.type,timeCreated:y.timeCreated,updated:y.updated,downloadURL:h};return console.log("File uploaded to Firebase Storage:",w),{file:w,downloadURL:h}}catch(e){throw console.error("Firebase Storage upload error:",e),Error("Dosya y\xfckleme başarısız")}}static async listUserFiles(e){try{let t=(0,r.KR)(i.IG,"users/".concat(e)),a=await (0,r._w)(t),l=[];for(let e of a.prefixes)for(let t of(await (0,r._w)(e)).items)try{let[e,a]=await Promise.all([(0,r.yb)(t),(0,r.qk)(t)]);l.push({id:t.name,name:t.name,fullPath:t.fullPath,size:e.size,contentType:e.contentType||"application/octet-stream",timeCreated:e.timeCreated,updated:e.updated,downloadURL:a})}catch(e){console.warn("Error getting file metadata:",t.fullPath,e)}return l.sort((e,t)=>new Date(t.timeCreated).getTime()-new Date(e.timeCreated).getTime()),l}catch(e){throw console.error("Firebase Storage list error:",e),Error("Dosya listesi alınamadı")}}static async deleteFile(e,t){try{if(!t.startsWith("users/".concat(e,"/")))throw Error("Bu dosyaya erişim izniniz yok");let a=(0,r.KR)(i.IG,t);await (0,r.XR)(a),console.log("File deleted from Firebase Storage:",t)}catch(e){throw console.error("Firebase Storage delete error:",e),Error("Dosya silinirken hata oluştu")}}static formatFileSize(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}static async calculateUserQuota(e){try{let t=(await this.listUserFiles(e)).reduce((e,t)=>e+t.size,0);return{used:t,limit:0x140000000,percentage:Math.min(t/0x140000000*100,100)}}catch(e){return console.error("Error calculating quota:",e),{used:0,limit:0x140000000,percentage:0}}}static async cleanupExpiredFiles(e){try{let t=await this.listUserFiles(e),a=new Date,r=new Date(a.getTime()-2592e6),i=0;for(let a of t)if(new Date(a.timeCreated)<r)try{await this.deleteFile(e,a.fullPath),i++}catch(e){console.warn("Error deleting expired file:",a.fullPath,e)}return console.log("Cleaned up ".concat(i," expired files for user ").concat(e)),i}catch(e){return console.error("Error cleaning up expired files:",e),0}}}},347:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[3838,2992,1794,8779,5228,6335,3238,7444,8848,622,7979,4884,7098,9744,2033,2322,9592,7331,5030,8392,7694,3719,5845,9915,8049,2922,6137,5070,2707,8007,39,408,7146,8441,7358],()=>t(1121)),_N_E=e.O()}]);