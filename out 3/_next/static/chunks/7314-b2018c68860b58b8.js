"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7314],{7314:(e,t,a)=>{a.d(t,{m2:()=>c});var i=a(7058),r=a(4595);let s={USER_ACTIVITIES:"userActivities"};var o=a(2638);class c{static async createActivity(e,t){try{let a=new Date,o=new Date(a.getTime()+2592e6),c={userId:e,timestamp:a,expiresAt:o,...t,status:t.status||"processing"};t.downloadUrl&&(c.downloadUrl=t.downloadUrl),void 0!==t.compressionRatio&&(c.compressionRatio=t.compressionRatio),void 0!==t.processingTime&&(c.processingTime=t.processingTime),t.googleDriveFileId&&(c.googleDriveFileId=t.googleDriveFileId),void 0!==t.processedSize&&(c.processedSize=t.processedSize);let n=Object.fromEntries(Object.entries({...c,timestamp:i.Dc.fromDate(c.timestamp),expiresAt:i.Dc.fromDate(c.expiresAt)}).filter(e=>{let[,t]=e;return void 0!==t})),l={id:(await (0,i.gS)((0,i.rJ)(r.kA,s.USER_ACTIVITIES),n)).id,...c};return{success:!0,data:l,timestamp:a}}catch(a){return console.error("Error creating activity:",a),(0,o.gr)(a,{code:a.code||"activity-create-failed",customData:{operation:"create_activity",userId:e,activityType:t.type}}),{success:!1,error:"Activity kaydı oluşturulamadı",timestamp:new Date}}}static async updateActivity(e,t){try{let a=(0,i.H9)(r.kA,s.USER_ACTIVITIES,e),o={};return Object.keys(t).forEach(e=>{let a=t[e];void 0!==a&&(o[e]=a)}),await (0,i.mZ)(a,o),{success:!0,data:!0,timestamp:new Date}}catch(a){return console.error("Error updating activity:",a),(0,o.gr)(a,{code:a.code||"activity-update-failed",customData:{operation:"update_activity",activityId:e,updates:t}}),{success:!1,error:"Activity g\xfcncellenemedi",timestamp:new Date}}}static async getUserActivities(e,t){try{let a=(0,i.rJ)(r.kA,s.USER_ACTIVITIES),o=(0,i.P)(a,(0,i._M)("userId","==",e));(null==t?void 0:t.type)&&t.type.length>0&&(o=(0,i.P)(o,(0,i._M)("type","in",t.type))),(null==t?void 0:t.status)&&t.status.length>0&&(o=(0,i.P)(o,(0,i._M)("status","in",t.status))),(null==t?void 0:t.category)&&t.category.length>0&&(o=(0,i.P)(o,(0,i._M)("category","in",t.category))),(null==t?void 0:t.dateRange)&&(o=(0,i.P)(o,(0,i._M)("timestamp",">=",i.Dc.fromDate(t.dateRange.start)),(0,i._M)("timestamp","<=",i.Dc.fromDate(t.dateRange.end))));let c=(null==t?void 0:t.sortBy)||"timestamp",n=(null==t?void 0:t.sortOrder)||"desc";o=(0,i.P)(o,(0,i.My)(c,n));let l=(null==t?void 0:t.limit)||20;o=(0,i.P)(o,(0,i.AB)(l));let d=await (0,i.GG)(o),m=[];d.forEach(e=>{var t,a;let i=e.data();m.push({id:e.id,...i,timestamp:(null===(t=i.timestamp)||void 0===t?void 0:t.toDate())||new Date,expiresAt:(null===(a=i.expiresAt)||void 0===a?void 0:a.toDate())||new Date})});let u=m.length,p=Math.floor(((null==t?void 0:t.offset)||0)/l)+1,g=m.length===l;return{success:!0,data:{items:m,total:u,page:p,limit:l,hasMore:g},timestamp:new Date}}catch(a){return console.error("Error fetching user activities:",a),(0,o.gr)(a,{code:a.code||"activities-fetch-failed",customData:{operation:"get_user_activities",userId:e,filter:t}}),{success:!1,error:"Aktiviteler getirilemedi",timestamp:new Date}}}static async getActivity(e){try{var t,a;let o=(0,i.H9)(r.kA,s.USER_ACTIVITIES,e),c=await (0,i.x7)(o);if(!c.exists())return{success:!1,error:"Aktivite bulunamadı",timestamp:new Date};let n=c.data(),l={id:c.id,...n,timestamp:(null===(t=n.timestamp)||void 0===t?void 0:t.toDate())||new Date,expiresAt:(null===(a=n.expiresAt)||void 0===a?void 0:a.toDate())||new Date};return{success:!0,data:l,timestamp:new Date}}catch(t){return console.error("Error fetching activity:",t),(0,o.gr)(t,{code:t.code||"activity-fetch-failed",customData:{operation:"get_activity",activityId:e}}),{success:!1,error:"Aktivite detayı getirilemedi",timestamp:new Date}}}static async getUserStats(e){try{var t;let a=(0,i.rJ)(r.kA,s.USER_ACTIVITIES),o=(0,i.P)(a,(0,i._M)("userId","==",e),(0,i.My)("timestamp","desc")),c=await (0,i.GG)(o),n=0,l=0,d=0,m=0,u=0,p=0,g={pdf_compress:0,pdf_convert:0,image_convert:0},v=new Date().getMonth(),y=new Date().getFullYear();c.forEach(e=>{var t;let a=e.data();n++,a.fileSize&&a.processedSize&&(l+=a.fileSize-a.processedSize);let i=null===(t=a.timestamp)||void 0===t?void 0:t.toDate();i&&i.getMonth()===v&&i.getFullYear()===y&&d++,"success"===a.status&&m++,a.processingTime&&"number"==typeof a.processingTime&&(u+=a.processingTime,p++),a.type&&a.type in g&&g[a.type]++});let D=(null===(t=Object.entries(g).sort((e,t)=>{let[,a]=e,[,i]=t;return i-a})[0])||void 0===t?void 0:t[0])||"pdf_compress",w=n>0?m/n*100:0,f=p>0?u/p:0;return{success:!0,data:{totalFiles:n,totalSizeSaved:l,thisMonthFiles:d,favoriteFeature:D,successRate:w,avgProcessingTime:f},timestamp:new Date}}catch(t){return console.error("Error calculating user stats:",t),(0,o.gr)(t,{code:t.code||"stats-calculation-failed",customData:{operation:"get_user_stats",userId:e}}),{success:!1,error:"İstatistikler hesaplanamadı",timestamp:new Date}}}static async getExpiringActivities(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{let t=new Date;t.setDate(t.getDate()+e);let a=(0,i.rJ)(r.kA,s.USER_ACTIVITIES),o=(0,i.P)(a,(0,i._M)("expiresAt","<=",i.Dc.fromDate(t)),(0,i._M)("status","==","success"),(0,i.My)("expiresAt","asc")),c=await (0,i.GG)(o),n=[];return c.forEach(e=>{var t,a;let i=e.data();n.push({id:e.id,...i,timestamp:(null===(t=i.timestamp)||void 0===t?void 0:t.toDate())||new Date,expiresAt:(null===(a=i.expiresAt)||void 0===a?void 0:a.toDate())||new Date})}),{success:!0,data:n,timestamp:new Date}}catch(t){return console.error("Error fetching expiring activities:",t),(0,o.gr)(t,{code:t.code||"expiring-activities-failed",customData:{operation:"get_expiring_activities",daysBeforeExpiration:e}}),{success:!1,error:"S\xfcresi dolan aktiviteler getirilemedi",timestamp:new Date}}}static async getCategoryCounts(e){try{let t=(0,i.rJ)(r.kA,s.USER_ACTIVITIES),a=(0,i.P)(t,(0,i._M)("userId","==",e)),o=await (0,i.GG)(a),c={PDF:0,Image:0,Document:0};return o.forEach(e=>{let t=e.data();t.category&&c.hasOwnProperty(t.category)&&c[t.category]++}),{success:!0,data:c,timestamp:new Date}}catch(t){return console.error("Error fetching category counts:",t),(0,o.gr)(t,{code:t.code||"category-counts-failed",customData:{operation:"get_category_counts",userId:e}}),{success:!1,error:"Kategori sayıları getirilemedi",timestamp:new Date}}}}}}]);