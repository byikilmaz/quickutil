"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3768],{43768:(e,t,o)=>{o.d(t,{EX:()=>p,Wl:()=>g,compressImageAdvanced:()=>d,ey:()=>f,fj:()=>w,getMobileOptimizedSettings:()=>n,hC:()=>l,tF:()=>y,v7:()=>h,vX:()=>m,yh:()=>u});var i=o(2818);function a(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function r(){return window.devicePixelRatio||1}function n(e,t){let o=a(),i=r();return(console.log("\uD83D\uDD0D Device info:",{isMobile:o,devicePixelRatio:i,fileSize:e,originalFormat:t}),o)?e>5242880?{quality:.75,format:"jpeg",maxWidth:Math.min(1920,Math.floor(1920/Math.max(i,1.5))),maxHeight:Math.min(1080,Math.floor(1080/Math.max(i,1.5)))}:e>2097152?{quality:.8,format:"jpeg",maxWidth:Math.min(1600,Math.floor(1600/Math.max(i,1.5))),maxHeight:Math.min(900,Math.floor(900/Math.max(i,1.5)))}:e>1048576?{quality:.85,format:"image/png"===t?"jpeg":void 0,maxWidth:Math.floor(1200/Math.max(i,1.2)),maxHeight:Math.floor(800/Math.max(i,1.2))}:{quality:.9,format:"image/png"===t&&e>512e3?"jpeg":void 0}:e>5242880?{quality:.6,maxWidth:1920,maxHeight:1080}:e>2097152?{quality:.7,maxWidth:2560,maxHeight:1440}:e>1048576?{quality:.8}:{quality:.9}}async function l(e,t){return new Promise((o,i)=>{let a=new Image,r=document.createElement("canvas"),n=r.getContext("2d");if(!n){i(Error("Canvas context not available"));return}a.onload=()=>{try{let{width:l,height:c}=a;t.maxWidth&&l>t.maxWidth&&(c=c*t.maxWidth/l,l=t.maxWidth),t.maxHeight&&c>t.maxHeight&&(l=l*t.maxHeight/c,c=t.maxHeight),r.width=l,r.height=c,n.drawImage(a,0,0,l,c),r.toBlob(r=>{if(!r){i(Error("Image conversion failed"));return}let n=new File([r],"".concat(s(e.name),".").concat(t.format),{type:"image/".concat(t.format),lastModified:Date.now()}),l=r.size/e.size;o({file:n,originalSize:e.size,newSize:r.size,compressionRatio:l}),URL.revokeObjectURL(a.src)},"image/".concat(t.format),t.quality)}catch(e){URL.revokeObjectURL(a.src),i(e)}},a.onerror=()=>{URL.revokeObjectURL(a.src),i(Error("Failed to load image"))},a.src=URL.createObjectURL(e)})}function c(e){switch(e){case"image/png":return"png";case"image/jpeg":case"image/jpg":default:return"jpeg";case"image/webp":return"webp"}}function s(e){return e.replace(/\.[^/.]+$/,"")}function g(e){return["image/png","image/jpeg","image/jpg","image/webp"].includes(e.type)}function m(e){return new Promise((t,o)=>{let i=new Image;i.onload=()=>{t({width:i.naturalWidth,height:i.naturalHeight}),URL.revokeObjectURL(i.src)},i.onerror=()=>{o(Error("Failed to load image for dimension reading")),URL.revokeObjectURL(i.src)},i.src=URL.createObjectURL(e)})}function h(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}async function d(e,t){let o=e;if(w(e))try{console.log("\uD83D\uDCF1 HEIC format detected, converting to JPEG first..."),o=await p(e),console.log("✅ HEIC converted to JPEG successfully")}catch(e){throw console.error("❌ HEIC conversion failed:",e),Error("HEIC format işlenemedi: ".concat(e instanceof Error?e.message:"Bilinmeyen hata"))}return new Promise((i,n)=>{let l=new Image,g=document.createElement("canvas"),m=g.getContext("2d");if(!m){n(Error("Canvas context not available"));return}l.onload=()=>{try{let h=a(),d=r();console.log("\uD83D\uDDBC️ Image compression started:",{isMobile:h,devicePixelRatio:d,originalSize:e.size,processedSize:o.size,originalFormat:e.type,processedFormat:o.type,originalDimensions:{width:l.width,height:l.height},isHEIC:w(e)});let{width:u,height:f}=l;h&&d>1&&(u=Math.floor(u/d),f=Math.floor(f/d),console.log("\uD83D\uDCF1 Mobile DPI normalization:",{width:u,height:f,devicePixelRatio:d})),t.maxWidth&&u>t.maxWidth&&(f=f*t.maxWidth/u,u=t.maxWidth),t.maxHeight&&f>t.maxHeight&&(u=u*t.maxHeight/f,f=t.maxHeight),u=Math.max(u,100),f=Math.max(f,100),g.width=u,g.height=f,h?(m.imageSmoothingEnabled=!(d>2),m.imageSmoothingQuality=d>2?"low":"medium"):(m.imageSmoothingEnabled=!0,m.imageSmoothingQuality="high"),m.drawImage(l,0,0,u,f);let y=t.format||c(o.type);h&&("image/png"===o.type&&o.size>512e3||w(e))&&(y="jpeg",console.log("\uD83D\uDCF1 Mobile PNG→JPEG conversion for better compression"));let p="image/".concat(y),E=t.quality;h&&E>.9&&(E=Math.min(E,.9),console.log("\uD83D\uDCF1 Mobile quality capped at:",E)),g.toBlob(t=>{if(!t){n(Error("Image compression failed"));return}let o=new File([t],"".concat(s(e.name),"_compressed.").concat(y),{type:p,lastModified:Date.now()}),a=t.size/e.size,r=(e.size-t.size)/e.size*100;console.log("✅ Compression completed:",{originalSize:e.size,newSize:t.size,sizeReduction:r.toFixed(1)+"%",compressionRatio:a.toFixed(3),finalDimensions:{width:u,height:f},outputFormat:y,isMobile:h,wasHEIC:w(e)}),i({file:o,originalSize:e.size,newSize:t.size,compressionRatio:a}),URL.revokeObjectURL(l.src)},p,E)}catch(e){console.error("❌ Image compression error:",e),URL.revokeObjectURL(l.src),n(e)}},l.onerror=()=>{URL.revokeObjectURL(l.src),n(Error("Failed to load image"))},l.src=URL.createObjectURL(o)})}async function u(e,t){return new Promise((o,i)=>{let a=new Image,r=document.createElement("canvas"),n=r.getContext("2d");if(!n){i(Error("Canvas context not available"));return}a.onload=()=>{try{let l=a.width,g=a.height,m=t.width||l,h=t.height||g;if(!1!==t.maintainAspectRatio){if(t.width&&!t.height)h=g*m/l;else if(t.height&&!t.width)m=l*h/g;else if(t.width&&t.height){let e=l/g,o=m/h;"fit"===t.resizeMode&&(e>o?h=m/e:m=h*e)}}r.width=m,r.height=h,n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(a,0,0,m,h);let d=c(e.type),u="image/".concat(d);r.toBlob(t=>{if(!t){i(Error("Image resize failed"));return}let r=new File([t],"".concat(s(e.name),"_resized.").concat(d),{type:u,lastModified:Date.now()});o({file:r,originalSize:e.size,newSize:t.size,compressionRatio:t.size/e.size}),URL.revokeObjectURL(a.src)},u,.9)}catch(e){URL.revokeObjectURL(a.src),i(e)}},a.onerror=()=>{URL.revokeObjectURL(a.src),i(Error("Failed to load image"))},a.src=URL.createObjectURL(e)})}async function f(e,t){return new Promise((o,i)=>{let a=new Image,r=document.createElement("canvas"),n=r.getContext("2d");if(!n){i(Error("Canvas context not available"));return}a.onload=()=>{try{if(t.x<0||t.y<0||t.x+t.width>a.width||t.y+t.height>a.height){i(Error("Crop dimensions are out of image bounds"));return}r.width=t.width,r.height=t.height,n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(a,t.x,t.y,t.width,t.height,0,0,t.width,t.height);let l=c(e.type),g="image/".concat(l);r.toBlob(t=>{if(!t){i(Error("Image crop failed"));return}let r=new File([t],"".concat(s(e.name),"_cropped.").concat(l),{type:g,lastModified:Date.now()});o({file:r,originalSize:e.size,newSize:t.size,compressionRatio:t.size/e.size}),URL.revokeObjectURL(a.src)},g,.9)}catch(e){URL.revokeObjectURL(a.src),i(e)}},a.onerror=()=>{URL.revokeObjectURL(a.src),i(Error("Failed to load image"))},a.src=URL.createObjectURL(e)})}async function y(e,t){return new Promise((o,i)=>{let a=new Image,r=document.createElement("canvas"),n=r.getContext("2d");if(!n){i(Error("Canvas context not available"));return}a.onload=()=>{try{let l=t.angle*Math.PI/180,g=Math.abs(Math.cos(l)),m=Math.abs(Math.sin(l)),h=a.width*g+a.height*m,d=a.width*m+a.height*g;r.width=h,r.height=d,n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.translate(h/2,d/2),n.rotate(l),n.drawImage(a,-a.width/2,-a.height/2);let u=c(e.type),f="image/".concat(u);r.toBlob(t=>{if(!t){i(Error("Image rotation failed"));return}let r=new File([t],"".concat(s(e.name),"_rotated.").concat(u),{type:f,lastModified:Date.now()});o({file:r,originalSize:e.size,newSize:t.size,compressionRatio:t.size/e.size}),URL.revokeObjectURL(a.src)},f,.9)}catch(e){URL.revokeObjectURL(a.src),i(e)}},a.onerror=()=>{URL.revokeObjectURL(a.src),i(Error("Failed to load image"))},a.src=URL.createObjectURL(e)})}function w(e){return"image/heic"===e.type||"image/heif"===e.type||e.name.toLowerCase().endsWith(".heic")||e.name.toLowerCase().endsWith(".heif")}async function p(e){try{console.log("\uD83D\uDD04 Converting HEIC to JPEG with heic2any library"),console.log("\uD83D\uDCC1 Input file:",e.name,"Size:",h(e.size),"Type:",e.type);try{let t;let i=(await o.e(2e3).then(o.t.bind(o,77712,23))).default;console.log("\uD83D\uDCE6 heic2any library loaded successfully"),console.log("\uD83D\uDE80 Starting HEIC conversion with progressive quality...");let a=null,r=null;for(let t of[.8,.9,.7,.6,.5])try{console.log("\uD83D\uDD04 Trying HEIC conversion with quality: ".concat(t)),r=await i({blob:e,toType:"image/jpeg",quality:t}),console.log("✅ HEIC conversion successful with quality: ".concat(t));break}catch(e){console.log("❌ Quality ".concat(t," failed:"),e),a=e;continue}if(!r)throw a||Error("All quality levels failed");console.log("✅ HEIC conversion completed"),console.log("\uD83D\uDCCA Conversion result type:",typeof r),t=Array.isArray(r)?r[0]:r;let n=new File([t],e.name.replace(/\.(heic|heif)$/i,".jpg"),{type:"image/jpeg",lastModified:Date.now()});return console.log("\uD83D\uDCC4 Converted file created:",n.name,"Size:",h(n.size)),n}catch(o){console.warn("❌ Client-side HEIC conversion failed, trying server-side fallback"),console.log("\uD83D\uDD0D Client error details:",o);let t=o instanceof Error?o.message:String(o);return(t.includes("Could not parse HEIF file")||t.includes("format not supported")||t.includes("ERR_LIBHEIF"))&&console.log("\uD83D\uDD27 heic2any library compatibility issue detected, using server fallback"),await E(e)}}catch(e){throw console.error("❌ HEIC conversion failed completely:",e),console.log("\uD83D\uDD0D Error details:",{name:e instanceof Error?e.name:"Unknown",message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),Error('HEIC d\xf6n\xfcşt\xfcrme başarısız. \n    \n\uD83D\uDCF1 iPhone/iPad Kullanıcıları i\xe7in Hızlı \xc7\xf6z\xfcm:\n1. Fotoğraflar uygulamasını a\xe7ın\n2. Fotoğrafınızı se\xe7in\n3. Paylaş butonuna tıklayın  \n4. "JPEG olarak kopyala" se\xe7eneğini se\xe7in\n5. Kopyalanan JPEG dosyasını buraya y\xfckleyin\n\nYa da Settings > Camera > Format\'tan "Most Compatible" se\xe7eneğini aktif edin.')}}async function E(e){try{console.log("\uD83C\uDF10 Starting server-side HEIC conversion...");let t=new FormData;t.append("file",e);let o=i.env.NEXT_PUBLIC_SERVER_URL||"https://quickutil-server.onrender.com",a="".concat(o,"/convert-heic");console.log("\uD83D\uDCE1 Sending HEIC file to server:",a);let r=await fetch(a,{method:"POST",body:t});if(!r.ok){let e=await r.json();throw Error(e.error||"Server error: ".concat(r.status))}let n=await r.blob(),l=new File([n],e.name.replace(/\.(heic|heif)$/i,".jpg"),{type:"image/jpeg",lastModified:Date.now()});return console.log("✅ Server-side HEIC conversion successful"),console.log("\uD83D\uDCC4 Converted file:",l.name,"Size:",h(l.size)),l}catch(e){throw console.error("❌ Server-side HEIC conversion failed:",e),Error("Server-side HEIC d\xf6n\xfcşt\xfcrme başarısız: ".concat(e instanceof Error?e.message:"Bilinmeyen hata"))}}}}]);