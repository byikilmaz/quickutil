"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3768],{43768:(e,t,i)=>{i.d(t,{EX:()=>v,Wl:()=>h,compressImageAdvanced:()=>f,ey:()=>p,fj:()=>b,getMobileOptimizedSettings:()=>c,hC:()=>s,tF:()=>w,v7:()=>u,vX:()=>d,yh:()=>y});let o="https://quickutil-image-api.onrender.com";async function a(){try{let e=await fetch("".concat(o,"/health"),{method:"GET",headers:{Accept:"application/json"}});if(e.ok){let t=await e.json();return console.log("✅ Image API is available:",t),!0}return console.log("❌ Image API health check failed:",e.status),!1}catch(e){return console.log("❌ Image API is not available:",e),!1}}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:85;try{console.log("\uD83D\uDD27 Converting HEIC using server-side API...");let i=new FormData;i.append("file",e),i.append("quality",t.toString());let a=await fetch("".concat(o,"/heic-convert"),{method:"POST",body:i,headers:{Accept:"application/octet-stream"}});if(!a.ok){let e=await a.json();throw Error(e.error||"Server error: ".concat(a.status))}let n=await a.blob(),r=new File([n],"".concat(m(e.name),".jpg"),{type:"image/jpeg",lastModified:Date.now()});return console.log("✅ Server-side HEIC conversion successful:",{originalSize:e.size,convertedSize:r.size,compressionRatio:((e.size-r.size)/e.size*100).toFixed(1)+"%"}),r}catch(e){throw console.error("❌ Server-side HEIC conversion failed:",e),e}}function r(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function l(){return window.devicePixelRatio||1}function c(e,t){let i=r(),o=l();return(console.log("\uD83D\uDD0D Device info:",{isMobile:i,devicePixelRatio:o,fileSize:e,originalFormat:t}),i)?e>5242880?{quality:.75,format:"jpeg",maxWidth:Math.min(1920,Math.floor(1920/Math.max(o,1.5))),maxHeight:Math.min(1080,Math.floor(1080/Math.max(o,1.5)))}:e>2097152?{quality:.8,format:"jpeg",maxWidth:Math.min(1600,Math.floor(1600/Math.max(o,1.5))),maxHeight:Math.min(900,Math.floor(900/Math.max(o,1.5)))}:e>1048576?{quality:.85,format:"image/png"===t?"jpeg":void 0,maxWidth:Math.floor(1200/Math.max(o,1.2)),maxHeight:Math.floor(800/Math.max(o,1.2))}:{quality:.9,format:"image/png"===t&&e>512e3?"jpeg":void 0}:e>5242880?{quality:.6,maxWidth:1920,maxHeight:1080}:e>2097152?{quality:.7,maxWidth:2560,maxHeight:1440}:e>1048576?{quality:.8}:{quality:.9}}async function s(e,t){return new Promise((i,o)=>{let a=new Image,n=document.createElement("canvas"),r=n.getContext("2d");if(!r){o(Error("Canvas context not available"));return}a.onload=()=>{try{let{width:l,height:c}=a;t.maxWidth&&l>t.maxWidth&&(c=c*t.maxWidth/l,l=t.maxWidth),t.maxHeight&&c>t.maxHeight&&(l=l*t.maxHeight/c,c=t.maxHeight),n.width=l,n.height=c,r.drawImage(a,0,0,l,c),n.toBlob(n=>{if(!n){o(Error("Image conversion failed"));return}let r=new File([n],"".concat(m(e.name),".").concat(t.format),{type:"image/".concat(t.format),lastModified:Date.now()}),l=n.size/e.size;i({file:r,originalSize:e.size,newSize:n.size,compressionRatio:l}),URL.revokeObjectURL(a.src)},"image/".concat(t.format),t.quality)}catch(e){URL.revokeObjectURL(a.src),o(e)}},a.onerror=()=>{URL.revokeObjectURL(a.src),o(Error("Failed to load image"))},a.src=URL.createObjectURL(e)})}function g(e){switch(e){case"image/png":return"png";case"image/jpeg":case"image/jpg":default:return"jpeg";case"image/webp":return"webp"}}function m(e){return e.replace(/\.[^/.]+$/,"")}function h(e){return["image/png","image/jpeg","image/jpg","image/webp","image/heic","image/heif"].includes(e.type)?e.size>0x3200000?{isValid:!1,error:"Dosya boyutu \xe7ok b\xfcy\xfck: ".concat(u(e.size),". Maksimum boyut: 50MB")}:{isValid:!0}:{isValid:!1,error:"Desteklenmeyen dosya formatı: ".concat(e.type,". Desteklenen formatlar: PNG, JPEG, WebP, HEIC")}}function d(e){return new Promise((t,i)=>{let o=new Image;o.onload=()=>{t({width:o.naturalWidth,height:o.naturalHeight}),URL.revokeObjectURL(o.src)},o.onerror=()=>{i(Error("Failed to load image for dimension reading")),URL.revokeObjectURL(o.src)},o.src=URL.createObjectURL(e)})}function u(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}async function f(e,t){let i=e;if(b(e))try{console.log("\uD83D\uDCF1 HEIC format detected, converting to JPEG first..."),i=await v(e),console.log("✅ HEIC converted to JPEG successfully")}catch(e){throw console.error("❌ HEIC conversion failed:",e),Error("HEIC format işlenemedi: ".concat(e instanceof Error?e.message:"Bilinmeyen hata"))}return new Promise((o,a)=>{let n=new Image,c=document.createElement("canvas"),s=c.getContext("2d");if(!s){a(Error("Canvas context not available"));return}n.onload=()=>{try{let h=r(),d=l();console.log("\uD83D\uDDBC️ Image compression started:",{isMobile:h,devicePixelRatio:d,originalSize:e.size,processedSize:i.size,originalFormat:e.type,processedFormat:i.type,originalDimensions:{width:n.width,height:n.height},isHEIC:b(e)});let{width:u,height:f}=n;h&&d>1&&(u=Math.floor(u/d),f=Math.floor(f/d),console.log("\uD83D\uDCF1 Mobile DPI normalization:",{width:u,height:f,devicePixelRatio:d})),t.maxWidth&&u>t.maxWidth&&(f=f*t.maxWidth/u,u=t.maxWidth),t.maxHeight&&f>t.maxHeight&&(u=u*t.maxHeight/f,f=t.maxHeight),u=Math.max(u,100),f=Math.max(f,100),c.width=u,c.height=f,h?(s.imageSmoothingEnabled=!(d>2),s.imageSmoothingQuality=d>2?"low":"medium"):(s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high"),s.drawImage(n,0,0,u,f);let y=t.format||g(i.type);h&&("image/png"===i.type&&i.size>512e3||b(e))&&(y="jpeg",console.log("\uD83D\uDCF1 Mobile PNG→JPEG conversion for better compression"));let p="image/".concat(y),w=t.quality;h&&w>.9&&(w=Math.min(w,.9),console.log("\uD83D\uDCF1 Mobile quality capped at:",w)),c.toBlob(t=>{if(!t){a(Error("Image compression failed"));return}let i=new File([t],"".concat(m(e.name),"_compressed.").concat(y),{type:p,lastModified:Date.now()}),r=t.size/e.size,l=(e.size-t.size)/e.size*100;console.log("✅ Compression completed:",{originalSize:e.size,newSize:t.size,sizeReduction:l.toFixed(1)+"%",compressionRatio:r.toFixed(3),finalDimensions:{width:u,height:f},outputFormat:y,isMobile:h,wasHEIC:b(e)}),o({file:i,originalSize:e.size,newSize:t.size,compressionRatio:r}),URL.revokeObjectURL(n.src)},p,w)}catch(e){console.error("❌ Image compression error:",e),URL.revokeObjectURL(n.src),a(e)}},n.onerror=()=>{URL.revokeObjectURL(n.src),a(Error("Failed to load image"))},n.src=URL.createObjectURL(i)})}async function y(e,t){return new Promise((i,o)=>{let a=new Image,n=document.createElement("canvas"),r=n.getContext("2d");if(!r){o(Error("Canvas context not available"));return}a.onload=()=>{try{let l=a.width,c=a.height,s=t.width||l,h=t.height||c;if(!1!==t.maintainAspectRatio){if(t.width&&!t.height)h=c*s/l;else if(t.height&&!t.width)s=l*h/c;else if(t.width&&t.height){let e=l/c,i=s/h;"fit"===t.resizeMode&&(e>i?h=s/e:s=h*e)}}n.width=s,n.height=h,r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.drawImage(a,0,0,s,h);let d=g(e.type),u="image/".concat(d);n.toBlob(t=>{if(!t){o(Error("Image resize failed"));return}let n=new File([t],"".concat(m(e.name),"_resized.").concat(d),{type:u,lastModified:Date.now()});i({file:n,originalSize:e.size,newSize:t.size,compressionRatio:t.size/e.size}),URL.revokeObjectURL(a.src)},u,.9)}catch(e){URL.revokeObjectURL(a.src),o(e)}},a.onerror=()=>{URL.revokeObjectURL(a.src),o(Error("Failed to load image"))},a.src=URL.createObjectURL(e)})}async function p(e,t){return new Promise((i,o)=>{let a=new Image,n=document.createElement("canvas"),r=n.getContext("2d");if(!r){o(Error("Canvas context not available"));return}a.onload=()=>{try{if(t.x<0||t.y<0||t.x+t.width>a.width||t.y+t.height>a.height){o(Error("Crop dimensions are out of image bounds"));return}n.width=t.width,n.height=t.height,r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.drawImage(a,t.x,t.y,t.width,t.height,0,0,t.width,t.height);let l=g(e.type),c="image/".concat(l);n.toBlob(t=>{if(!t){o(Error("Image crop failed"));return}let n=new File([t],"".concat(m(e.name),"_cropped.").concat(l),{type:c,lastModified:Date.now()});i({file:n,originalSize:e.size,newSize:t.size,compressionRatio:t.size/e.size}),URL.revokeObjectURL(a.src)},c,.9)}catch(e){URL.revokeObjectURL(a.src),o(e)}},a.onerror=()=>{URL.revokeObjectURL(a.src),o(Error("Failed to load image"))},a.src=URL.createObjectURL(e)})}async function w(e,t){return new Promise((i,o)=>{let a=new Image,n=document.createElement("canvas"),r=n.getContext("2d");if(!r){o(Error("Canvas context not available"));return}a.onload=()=>{try{let l=t.angle*Math.PI/180,c=Math.abs(Math.cos(l)),s=Math.abs(Math.sin(l)),h=a.width*c+a.height*s,d=a.width*s+a.height*c;n.width=h,n.height=d,r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.translate(h/2,d/2),r.rotate(l),r.drawImage(a,-a.width/2,-a.height/2);let u=g(e.type),f="image/".concat(u);n.toBlob(t=>{if(!t){o(Error("Image rotation failed"));return}let n=new File([t],"".concat(m(e.name),"_rotated.").concat(u),{type:f,lastModified:Date.now()});i({file:n,originalSize:e.size,newSize:t.size,compressionRatio:t.size/e.size}),URL.revokeObjectURL(a.src)},f,.9)}catch(e){URL.revokeObjectURL(a.src),o(e)}},a.onerror=()=>{URL.revokeObjectURL(a.src),o(Error("Failed to load image"))},a.src=URL.createObjectURL(e)})}function b(e){return"image/heic"===e.type||"image/heif"===e.type||e.name.toLowerCase().endsWith(".heic")||e.name.toLowerCase().endsWith(".heif")}async function v(e){try{if(console.log("\uD83D\uDD04 Converting HEIC to JPEG with server-side API first..."),console.log("\uD83D\uDCC1 Input file:",e.name,"Size:",u(e.size),"Type:",e.type),await a())try{console.log("\uD83D\uDD27 Using server-side HEIC conversion...");let t=await n(e,90);return console.log("✅ Server-side HEIC conversion successful"),t}catch(e){console.log("❌ Server-side HEIC conversion failed, falling back to client-side:",e)}console.log("\uD83D\uDCE6 Falling back to client-side heic2any conversion...");try{let t;let o=(await i.e(2e3).then(i.t.bind(i,77712,23))).default;console.log("\uD83D\uDCE6 heic2any library loaded successfully"),console.log("\uD83D\uDE80 Starting client-side HEIC conversion with progressive quality...");let a=null,n=null;for(let t of[.8,.9,.7,.6,.5])try{console.log("\uD83D\uDD04 Trying HEIC conversion with quality: ".concat(t)),n=await o({blob:e,toType:"image/jpeg",quality:t}),console.log("✅ HEIC conversion successful with quality: ".concat(t));break}catch(e){console.log("❌ Quality ".concat(t," failed:"),e),a=e;continue}if(!n)throw a||Error("All quality levels failed");console.log("✅ Client-side HEIC conversion completed"),console.log("\uD83D\uDCCA Conversion result type:",typeof n),t=Array.isArray(n)?n[0]:n;let r=new File([t],e.name.replace(/\.(heic|heif)$/i,".jpg"),{type:"image/jpeg",lastModified:Date.now()});return console.log("\uD83D\uDCC4 Converted file created:",r.name,"Size:",u(r.size)),r}catch(t){console.warn("❌ Client-side HEIC conversion failed"),console.log("\uD83D\uDD0D Client error details:",t);let e=t instanceof Error?t.message:String(t);throw(e.includes("Could not parse HEIF file")||e.includes("format not supported")||e.includes("ERR_LIBHEIF"))&&console.log("\uD83D\uDD27 heic2any library compatibility issue detected"),t}}catch(e){throw console.error("❌ HEIC conversion failed completely:",e),console.log("\uD83D\uDD0D Error details:",{name:e instanceof Error?e.name:"Unknown",message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),Error('HEIC d\xf6n\xfcşt\xfcrme başarısız. \n    \n\uD83D\uDCF1 iPhone/iPad Kullanıcıları i\xe7in Hızlı \xc7\xf6z\xfcm:\n1. Fotoğraflar uygulamasını a\xe7ın\n2. Fotoğrafınızı se\xe7in\n3. Paylaş butonuna tıklayın  \n4. "JPEG olarak kopyala" se\xe7eneğini se\xe7in\n5. Kopyalanan JPEG dosyasını buraya y\xfckleyin\n\nYa da Settings > Camera > Format\'tan "Most Compatible" se\xe7eneğini aktif edin.\n\n\uD83D\uDD27 Alternatif: Resimi \xf6nce başka bir ara\xe7la JPEG\'e d\xf6n\xfcşt\xfcr\xfcp tekrar deneyin.')}}}}]);